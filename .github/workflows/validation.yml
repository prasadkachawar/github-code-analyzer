name: Validation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Validate configuration
      run: |
        python -m static_analyzer.cli validate-config --config static_analyzer_config.yaml

    - name: Test web application
      run: |
        python -c "
        import sys
        sys.path.insert(0, '.')
        try:
            from app_simple import app
            print('✅ Web app imports successfully')
        except Exception as e:
            print(f'❌ Web app import failed: {e}')
            sys.exit(1)
        "

    - name: Test static analyzer
      run: |
        python -m static_analyzer.cli list-rules

    - name: Validate deployment files
      run: |
        echo "Checking deployment files..."
        ls -la requirements_minimal.txt render.yaml Procfile || echo "Some deployment files missing"
        echo "✅ Deployment files check complete"
